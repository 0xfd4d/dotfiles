#!/bin/sh
# Requires https://github.com/wmutils
#          https://github.com/halfwit/binpack

# Don't run if we're fullscreen
test -f ~/.fwin && export wid=`cat ~/.fwin | cut -f5 -d' '` && wattr m $wid && exit 0

WIN=~/dotfiles/window

winsize() {
    while read -r id; do
        # name="`xprop -id "$id" | awk '/WM_CLASS/{print $NF}' | tr -d '"' `" 
        # cmd="`awk -v r="$name" '$0 ~ r {err=1; $1=""; print} END {exit err}'\
        #     "$WIN" && awk '/default/{$1=""; print}' "$WIN"`"
        # printf '%s %s %s\n' "`eval "$cmd"`" "$id"
        printf '%s %s %s\n' "`wattr whwh $id`" "$id"
    done
}

. ~/dotfiles/size

# run the pipe
lsw | sort | winsize | binpack -x "$width" -y "$height" -g "$gaps" | xargs -n 5 wtp
